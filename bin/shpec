#!/bin/sh
. ${0%/*}/../share/shpec/shpec.sh

shpec_run() {
    (
        . "$1"
        SHPEC_EXIT_CODE=$?
        if [ "$SHPEC_EXIT_CODE" != 0 ]; then
            printf "FAIL %s\n" "$1" >&2
        fi

        return $SHPEC_EXIT_CODE
    )
}

shpec_main() {
    case $1 in
        -f)
            shpec_run $1
            return $?
            ;;
    esac

    for shpecfile in "${1:-t}"/*-shpec.sh; do
        if [ -e "$shpecfile" ]; then
            shpec_run "$shpecfile"
        fi
    done

    return $SHPEC_EXIT_CODE
}

shpec_main "$@"
